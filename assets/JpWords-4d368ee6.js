var $e=Object.defineProperty;var we=(l,e,t)=>e in l?$e(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Z=(l,e,t)=>(we(l,typeof e!="symbol"?e+"":e,t),t);import{S as _e,i as de,s as me,K as se,L as M,M as be,N as W,f as h,j as he,O as ne,P as ke,J as j,Q as A,R as ve,I as C,m as k,o as ae,p as De,q as oe,a as ee,v as Se,x as Ee,E as Be,F as Ie,G as Oe,H as Re,e as P,Z as w,b as N,c as O,g,_ as K,u as je,$ as le}from"./index-a74c4f92.js";import{C as z}from"./ActionIcons-f8455b21.js";import{B as Y}from"./Button-93bd4666.js";import{c as re,f as Ce,S as ce}from"./classAdderBuilder-e93541da.js";import{a as ue}from"./index-01446b21.js";import"./Ripple-ed61df69.js";function Ne(l){let e;const t=l[10].default,s=Be(t,l,l[12],null);return{c(){s&&s.c()},m(a,n){s&&s.m(a,n),e=!0},p(a,n){s&&s.p&&(!e||n&4096)&&Ie(s,t,a,a[12],e?Re(t,a[12],n,null):Oe(a[12]),null)},i(a){e||(C(s,a),e=!0)},o(a){j(s,a),e=!1},d(a){s&&s.d(a)}}}function Pe(l){let e,t,s;const a=[{tag:l[3]},{use:[l[5],...l[0]]},{class:re({[l[1]]:!0,"mdc-button__label":l[6]==="button","mdc-fab__label":l[6]==="fab","mdc-tab__text-label":l[6]==="tab","mdc-image-list__label":l[6]==="image-list","mdc-snackbar__label":l[6]==="snackbar","mdc-banner__text":l[6]==="banner","mdc-segmented-button__label":l[6]==="segmented-button","mdc-data-table__pagination-rows-per-page-label":l[6]==="data-table:pagination","mdc-data-table__header-cell-label":l[6]==="data-table:sortable-header-cell"})},l[6]==="snackbar"?{"aria-atomic":"false"}:{},{tabindex:l[7]},l[8]];var n=l[2];function r(o){let c={$$slots:{default:[Ne]},$$scope:{ctx:o}};for(let u=0;u<a.length;u+=1)c=ee(c,a[u]);return{props:c}}return n&&(e=se(n,r(l)),l[11](e)),{c(){e&&M(e.$$.fragment),t=be()},m(o,c){e&&W(e,o,c),h(o,t,c),s=!0},p(o,[c]){const u=c&491?he(a,[c&8&&{tag:o[3]},c&33&&{use:[o[5],...o[0]]},c&66&&{class:re({[o[1]]:!0,"mdc-button__label":o[6]==="button","mdc-fab__label":o[6]==="fab","mdc-tab__text-label":o[6]==="tab","mdc-image-list__label":o[6]==="image-list","mdc-snackbar__label":o[6]==="snackbar","mdc-banner__text":o[6]==="banner","mdc-segmented-button__label":o[6]==="segmented-button","mdc-data-table__pagination-rows-per-page-label":o[6]==="data-table:pagination","mdc-data-table__header-cell-label":o[6]==="data-table:sortable-header-cell"})},c&64&&ne(o[6]==="snackbar"?{"aria-atomic":"false"}:{}),c&128&&{tabindex:o[7]},c&256&&ne(o[8])]):{};if(c&4096&&(u.$$scope={dirty:c,ctx:o}),c&4&&n!==(n=o[2])){if(e){ke();const i=e;j(i.$$.fragment,1,0,()=>{A(i,1)}),ve()}n?(e=se(n,r(o)),o[11](e),M(e.$$.fragment),C(e.$$.fragment,1),W(e,t.parentNode,t)):e=null}else n&&e.$set(u)},i(o){s||(e&&C(e.$$.fragment,o),s=!0)},o(o){e&&j(e.$$.fragment,o),s=!1},d(o){l[11](null),o&&k(t),e&&A(e,o)}}}function Me(l,e,t){const s=["use","class","component","tag","getElement"];let a=ae(e,s),{$$slots:n={},$$scope:r}=e;const o=Ce(De());let{use:c=[]}=e,{class:u=""}=e,i,{component:_=ce}=e,{tag:m=_===ce?"span":void 0}=e;const B=oe("SMUI:label:context"),D=oe("SMUI:label:tabindex");function S(){return i.getElement()}function b(f){Ee[f?"unshift":"push"](()=>{i=f,t(4,i)})}return l.$$set=f=>{e=ee(ee({},e),Se(f)),t(8,a=ae(e,s)),"use"in f&&t(0,c=f.use),"class"in f&&t(1,u=f.class),"component"in f&&t(2,_=f.component),"tag"in f&&t(3,m=f.tag),"$$scope"in f&&t(12,r=f.$$scope)},[c,u,_,m,i,o,B,D,a,S,n,b,r]}class te extends _e{constructor(e){super(),de(this,e,Me,Pe,me,{use:0,class:1,component:2,tag:3,getElement:9})}get getElement(){return this.$$.ctx[9]}}const We="./store/version_map.json",Ae="./store/words.json";class Je{constructor(e){Z(this,"db");Z(this,"dbName");this.dbName=e,this.db=null}openStore(e,t,s){return new Promise((a,n)=>{const r=window.indexedDB.open(this.dbName,6);r.onsuccess=o=>{this.db=o.target.result,a(this.db)},r.onerror=o=>{n(o)},r.onupgradeneeded=o=>{const u=o.target.result.createObjectStore(e,{keyPath:t});Array.isArray(s)&&s.forEach(i=>{u.createIndex(i.key,i.key,{unique:i.unique})}),u.transaction.oncomplete=()=>{console.log("创建仓库成功")},console.log("更新成功"),console.log(o)}})}add(e,t){return new Promise((s,a)=>{const n=this.db.transaction([e],"readwrite").objectStore(e);let r=0,o=0;const c={onsuccess:i=>{++o>=r&&s({code:0,data:{total:r}})},onerror:i=>{a({code:1,message:i})}};let u;Array.isArray(t)?t.forEach(i=>{Array.isArray(i)?i.forEach(_=>{r++,u=n.put(_),u.onsuccess=c.onsuccess,u.onerror=c.onerror}):(u=n.put(i),u.onsuccess=c.onsuccess,u.onerror=c.onerror)}):(u=n.put(t),u.onsuccess=c.onsuccess,u.onerror=c.onerror)})}delete(e,t){return new Promise((s,a)=>{const n=this.db.transaction([e],"readwrite").objectStore(e).delete(t);n.onsuccess=()=>{s({code:0})},n.onerror=r=>{a({code:1,message:r})}})}getAllList(e){return new Promise((t,s)=>{const a=this.db.transaction([e]).objectStore(e).getAll();a.onsuccess=n=>{t(n.target.result)},a.onerror=n=>{s({code:1,message:n})}})}getItem(e,t){return new Promise((s,a)=>{const n=this.db.transaction([e]).objectStore(e).get(t);n.onsuccess=r=>{r.target.result?s({code:0,data:r.target.result}):s({code:1,data:r.target.result})},n.onerror=r=>{a({code:1,message:r})}})}async count(e,t){return new Promise((s,a)=>{const n=this.db.transaction([e],"readonly").objectStore(e);let r=n.count();t?r=n.index(t.key).count(t.range):r=n.count(),r.onsuccess=()=>{s(r.result)},r.onerror=o=>{a(o)}})}createCursor(e,t="",s){const a=this.db.transaction([e],"readonly").objectStore(e);let n;return t?n=a.index(t).openCursor(s):n=a.openKeyCursor(s),n}}const Ke="mahiru",R="js_word",y="has_study",T="not_study",L="not_good",qe=[{key:T,unique:!1},{key:y,unique:!1},{key:L,unique:!1}],x="word_version";function ye(l){let e,t,s,a,n,r,o,c,u,i,_,m,B,D,S;return{c(){e=P("div"),t=w("总词汇量："),s=w(l[0]),a=N(),n=P("div"),r=w("未学习："),o=w(l[1]),c=N(),u=P("div"),i=w("已学会："),_=w(l[2]),m=N(),B=P("div"),D=w("不熟悉："),S=w(l[3]),O(e,"class","summary-item svelte-x7nw2t"),O(n,"class","summary-item svelte-x7nw2t"),O(u,"class","summary-item svelte-x7nw2t"),O(B,"class","summary-item svelte-x7nw2t")},m(b,f){h(b,e,f),g(e,t),g(e,s),h(b,a,f),h(b,n,f),g(n,r),g(n,o),h(b,c,f),h(b,u,f),g(u,i),g(u,_),h(b,m,f),h(b,B,f),g(B,D),g(B,S)},p(b,f){f&1&&K(s,b[0]),f&2&&K(o,b[1]),f&4&&K(_,b[2]),f&8&&K(S,b[3])},d(b){b&&k(e),b&&k(a),b&&k(n),b&&k(c),b&&k(u),b&&k(m),b&&k(B)}}}function Te(l){let e,t,s;return{c(){e=w("学习进度："),t=w(l[4]),s=w("%")},m(a,n){h(a,e,n),h(a,t,n),h(a,s,n)},p(a,n){n&16&&K(t,a[4])},d(a){a&&k(e),a&&k(t),a&&k(s)}}}function ie(l){let e,t,s,a=l[6].desc+"",n,r=l[6].read&&fe(l);return{c(){r&&r.c(),e=N(),t=P("div"),s=w("翻译："),n=w(a),O(t,"class","desc svelte-x7nw2t")},m(o,c){r&&r.m(o,c),h(o,e,c),h(o,t,c),g(t,s),g(t,n)},p(o,c){o[6].read?r?r.p(o,c):(r=fe(o),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),c&64&&a!==(a=o[6].desc+"")&&K(n,a)},d(o){r&&r.d(o),o&&k(e),o&&k(t)}}}function fe(l){let e,t,s=l[6].read+"",a;return{c(){e=P("div"),t=w("读法："),a=w(s),O(e,"class","read svelte-x7nw2t")},m(n,r){h(n,e,r),g(e,t),g(e,a)},p(n,r){r&64&&s!==(s=n[6].read+"")&&K(a,s)},d(n){n&&k(e)}}}function Le(l){let e,t=l[6].word+"",s,a,n,r,o,c,u,i=l[9]&&ie(l);return{c(){e=P("div"),s=w(t),a=N(),n=P("span"),r=w(l[7]),c=N(),i&&i.c(),u=be(),O(n,"class",o=le(`tag jpw_tag-${l[8]}`)+" svelte-x7nw2t"),O(e,"class","word svelte-x7nw2t")},m(_,m){h(_,e,m),g(e,s),g(e,a),g(e,n),g(n,r),h(_,c,m),i&&i.m(_,m),h(_,u,m)},p(_,m){m&64&&t!==(t=_[6].word+"")&&K(s,t),m&128&&K(r,_[7]),m&256&&o!==(o=le(`tag jpw_tag-${_[8]}`)+" svelte-x7nw2t")&&O(n,"class",o),_[9]?i?i.p(_,m):(i=ie(_),i.c(),i.m(u.parentNode,u)):i&&(i.d(1),i=null)},d(_){_&&k(e),_&&k(c),i&&i.d(_),_&&k(u)}}}function Fe(l){let e;return{c(){e=w("展示")},m(t,s){h(t,e,s)},d(t){t&&k(e)}}}function Xe(l){let e,t;return e=new te({props:{$$slots:{default:[Fe]},$$scope:{ctx:l}}}),{c(){M(e.$$.fragment)},m(s,a){W(e,s,a),t=!0},p(s,a){const n={};a&67108864&&(n.$$scope={dirty:a,ctx:s}),e.$set(n)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){j(e.$$.fragment,s),t=!1},d(s){A(e,s)}}}function Ve(l){let e;return{c(){e=w("掌握")},m(t,s){h(t,e,s)},d(t){t&&k(e)}}}function Ge(l){let e,t;return e=new te({props:{$$slots:{default:[Ve]},$$scope:{ctx:l}}}),{c(){M(e.$$.fragment)},m(s,a){W(e,s,a),t=!0},p(s,a){const n={};a&67108864&&(n.$$scope={dirty:a,ctx:s}),e.$set(n)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){j(e.$$.fragment,s),t=!1},d(s){A(e,s)}}}function Ue(l){let e;return{c(){e=w("未掌握")},m(t,s){h(t,e,s)},d(t){t&&k(e)}}}function He(l){let e,t;return e=new te({props:{$$slots:{default:[Ue]},$$scope:{ctx:l}}}),{c(){M(e.$$.fragment)},m(s,a){W(e,s,a),t=!0},p(s,a){const n={};a&67108864&&(n.$$scope={dirty:a,ctx:s}),e.$set(n)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){j(e.$$.fragment,s),t=!1},d(s){A(e,s)}}}function Qe(l){let e,t,s,a,n,r,o,c,u,i,_,m,B,D,S,b,f,V,J,q;return c=new z({props:{class:"jpw_summary",variant:"outlined",padded:!0,$$slots:{default:[ye]},$$scope:{ctx:l}}}),i=new z({props:{class:"jpw_process",variant:"outlined",padded:!0,$$slots:{default:[Te]},$$scope:{ctx:l}}}),m=new z({props:{class:"jpw_word-container",padded:!0,$$slots:{default:[Le]},$$scope:{ctx:l}}}),S=new Y({props:{variant:"raised",class:"jpw_btn-show",$$slots:{default:[Xe]},$$scope:{ctx:l}}}),S.$on("click",l[10]),f=new Y({props:{variant:"raised",class:"jpw_btn-ok",$$slots:{default:[Ge]},$$scope:{ctx:l}}}),f.$on("click",l[12]),J=new Y({props:{variant:"raised",class:"jpw_btn-not",$$slots:{default:[He]},$$scope:{ctx:l}}}),J.$on("click",l[13]),{c(){e=P("div"),t=w(`背词小工具
  `),s=P("span"),a=w("版本："),n=w(l[5]),r=N(),o=P("div"),M(c.$$.fragment),u=N(),M(i.$$.fragment),_=N(),M(m.$$.fragment),B=N(),D=P("div"),M(S.$$.fragment),b=N(),M(f.$$.fragment),V=N(),M(J.$$.fragment),O(s,"class","version svelte-x7nw2t"),O(e,"class","title svelte-x7nw2t"),O(D,"class","btn-group svelte-x7nw2t"),O(o,"class","container svelte-x7nw2t")},m(d,$){h(d,e,$),g(e,t),g(e,s),g(s,a),g(s,n),h(d,r,$),h(d,o,$),W(c,o,null),g(o,u),W(i,o,null),g(o,_),W(m,o,null),g(o,B),g(o,D),W(S,D,null),g(D,b),W(f,D,null),g(D,V),W(J,D,null),q=!0},p(d,[$]){(!q||$&32)&&K(n,d[5]);const F={};$&67108879&&(F.$$scope={dirty:$,ctx:d}),c.$set(F);const G={};$&67108880&&(G.$$scope={dirty:$,ctx:d}),i.$set(G);const U={};$&67109824&&(U.$$scope={dirty:$,ctx:d}),m.$set(U);const H={};$&67108864&&(H.$$scope={dirty:$,ctx:d}),S.$set(H);const Q={};$&67108864&&(Q.$$scope={dirty:$,ctx:d}),f.$set(Q);const p={};$&67108864&&(p.$$scope={dirty:$,ctx:d}),J.$set(p)},i(d){q||(C(c.$$.fragment,d),C(i.$$.fragment,d),C(m.$$.fragment,d),C(S.$$.fragment,d),C(f.$$.fragment,d),C(J.$$.fragment,d),q=!0)},o(d){j(c.$$.fragment,d),j(i.$$.fragment,d),j(m.$$.fragment,d),j(S.$$.fragment,d),j(f.$$.fragment,d),j(J.$$.fragment,d),q=!1},d(d){d&&k(e),d&&k(r),d&&k(o),A(c),A(i),A(m),A(S),A(f),A(J)}}}function Ze(l,e,t){let s=0,a=0,n=0,r=0,o="0.00",c=null,u,i="0.0.0",_={word:"",desc:"",read:""},m="",B=0,D=!1;const S=()=>{t(9,D=!0)},b=async p=>{if(!D){S();return}t(9,D=!1);let v=_[L]||0,E=_[y];p?v>0&&v--:v++;const I={..._,[T]:0,[y]:E||p?1:0,[L]:v};await u.add(R,I),d(),f()},f=()=>{const p=Math.random();p<.1?$(1,IDBKeyRange.lowerBound(1),Math.ceil(Math.random()*n)):p<.3?$(2,IDBKeyRange.lowerBound(3),Math.ceil(Math.random()*r)):$(0,IDBKeyRange.lowerBound(1),Math.ceil(Math.random()*a))};async function V(){const p=await ue(We),v=localStorage.getItem(x),E=p.findIndex(I=>I===v);return p.slice(E+1)}async function J(p){c||(c=await ue(Ae));const v=[],{word:E,read:I,desc:pe}=c[p],ge=E.length;for(let X=0;X<ge;X++)v.push({[R]:E[X],word:E[X],read:I[X],desc:pe[X],[T]:1});return v}async function q(p){if(u=new Je(Ke),await u.openStore(R,R,qe),p){const{code:v}=await u.add(R,p);v===0&&localStorage.setItem(x,i)}U()}const d=async()=>{t(0,s=await u.count(R)),t(1,a=await u.count(R,{key:T,range:IDBKeyRange.lowerBound(1)})),t(2,n=await u.count(R,{key:y,range:IDBKeyRange.lowerBound(1)})),t(3,r=await u.count(R,{key:L,range:IDBKeyRange.lowerBound(3,!0)})),t(4,o=(n/s*100).toFixed(2))},$=(p=0,v,E=0)=>{if(p===0){const I=u.createCursor(R,T,v);I.onsuccess=F(T,E)}if(p===1){const I=u.createCursor(R,y,v);I.onsuccess=F(y,E)}if(p===2){const I=u.createCursor(R,L,v);I.onsuccess=F(L,E)}},F=(p,v)=>E=>{const I=E.target.result;if(!I){switch(p){case T:$(2);break;case y:$(0);break;case L:$(1);break}return}if(v>0){I.advance(v),v=0;return}switch(t(6,_=I.value||{}),p){case T:t(7,m="新"),t(8,B=0);break;case y:t(7,m="已掌握"),t(8,B=1);break;case L:t(7,m="不熟悉"),t(8,B=2);break}};async function G(){const p=await V();if(p.length===0){t(5,i=localStorage.getItem(x)),q();return}const v=[];for(let E=0;E<p.length;E++)v.push(await J(p[E]));t(5,i=p[p.length-1]),c=null,q(v)}async function U(){await d(),f()}return je(G),[s,a,n,r,o,i,_,m,B,D,S,b,()=>b(!0),()=>b(!1)]}class at extends _e{constructor(e){super(),de(this,e,Ze,Qe,me,{})}}export{at as default};
